{"version":3,"file":"index-D87g60pJ.js","sources":["../../src/main.js"],"sourcesContent":["import * as THREE from 'three';\r\nimport { ARButton } from 'three/addons/webxr/ARButton.js';\r\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\r\n\r\nlet container;\r\nlet camera, scene, renderer;\r\nlet controller;\r\n\r\nlet reticle;\r\n\r\nlet hitTestSource = null;\r\nlet hitTestSourceRequested = false;\r\n\r\nlet model;\r\n\r\nlet loadedFlask, loadedTube, loadedGlassBottle = false;\r\n\r\ninit();\r\n\r\nfunction init() {\r\n\r\n  const loader = new GLTFLoader().setPath('/RAUG-AR-Cahet-Codron/assets/models/');\r\n\r\n  container = document.createElement('div');\r\n  document.body.appendChild(container);\r\n\r\n  scene = new THREE.Scene();\r\n\r\n  camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);\r\n\r\n  const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 3);\r\n  light.position.set(0.5, 1, 0.25);\r\n  scene.add(light);\r\n\r\n  //\r\n\r\n  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\r\n  renderer.setPixelRatio(window.devicePixelRatio);\r\n  renderer.setSize(window.innerWidth, window.innerHeight);\r\n  renderer.setAnimationLoop(animate);\r\n  renderer.xr.enabled = true;\r\n  container.appendChild(renderer.domElement);\r\n\r\n  //\r\n\r\n  document.body.appendChild(ARButton.createButton(renderer, { requiredFeatures: ['hit-test'] }));\r\n\r\n  //\r\n\r\n  const geometry = new THREE.CylinderGeometry(0.1, 0.1, 0.2, 32).translate(0, 0.1, 0);\r\n\r\n  function onSelect() {\r\n\r\n    if (reticle.visible) {\r\n      if (!loadedFlask) {\r\n        // Load the flask\r\n        loader.load('flask.glb', (gltf) => {\r\n          model = gltf.scene;\r\n\r\n          reticle.matrix.decompose(model.position, model.quaternion, model.scale);\r\n\r\n          // Scale the model\r\n          model.scale.x = 0.1;\r\n          model.scale.y = 0.1;\r\n          model.scale.z = 0.1;\r\n\r\n          scene.add(model);\r\n\r\n          loadedFlask = true;\r\n\r\n          model.traverse(function (object) {\r\n            if (object.isMesh) object.castShadow = true;\r\n          });\r\n        });\r\n      }\r\n      else if (!loadedTube) {\r\n        // Load the tube\r\n        loader.load('tube.glb', (gltf) => {\r\n          model = gltf.scene;\r\n\r\n          reticle.matrix.decompose(model.position, model.quaternion, model.scale);\r\n\r\n          // Scale the model\r\n          model.scale.x = 0.1;\r\n          model.scale.y = 0.1;\r\n          model.scale.z = 0.1;\r\n\r\n          scene.add(model);\r\n\r\n          loadedTube = true;\r\n\r\n          model.traverse(function (object) {\r\n            if (object.isMesh) object.castShadow = true;\r\n          });\r\n        });\r\n      }\r\n      else if (!loadedGlassBottle) {\r\n        // Load the glass bottle\r\n        loader.load('glass-bottle.glb', (gltf) => {\r\n          model = gltf.scene;\r\n\r\n          reticle.matrix.decompose(model.position, model.quaternion, model.scale);\r\n\r\n          // Scale the model\r\n          model.scale.x = 0.05;\r\n          model.scale.y = 0.05;\r\n          model.scale.z = 0.05;\r\n\r\n          scene.add(model);\r\n\r\n          loadedGlassBottle = true;\r\n\r\n          model.traverse(function (object) {\r\n            if (object.isMesh) object.castShadow = true;\r\n          });\r\n        });\r\n      }\r\n      else {\r\n        const model = scene.children[3];\r\n\r\n        const duration = 3000;\r\n        const wiggleFrequency = 100;\r\n        const baseScale = 0.1;\r\n        const wiggleAmplitude = 0.01;\r\n        const startTime = performance.now();\r\n\r\n        let lastFrameTime = startTime;\r\n\r\n        function wiggle() {\r\n          const currentTime = performance.now();\r\n          const elapsedTime = currentTime - startTime;\r\n\r\n          if (elapsedTime < duration) {\r\n            if (currentTime - lastFrameTime >= wiggleFrequency) {\r\n              lastFrameTime = currentTime;\r\n              const scaleFactor = baseScale +\r\n                wiggleAmplitude * Math.sin((elapsedTime / 1000) * wiggleFrequency * 2 * Math.PI);\r\n              model.scale.set(scaleFactor, scaleFactor, scaleFactor);\r\n            }\r\n\r\n            requestAnimationFrame(wiggle);\r\n          } else {\r\n            model.scale.set(baseScale, baseScale, baseScale);\r\n          }\r\n        }\r\n\r\n        wiggle();\r\n      }\r\n    }\r\n  }\r\n\r\n  controller = renderer.xr.getController(0);\r\n  controller.addEventListener('select', onSelect);\r\n  scene.add(controller);\r\n\r\n  reticle = new THREE.Mesh(\r\n    new THREE.RingGeometry(0.15, 0.2, 32).rotateX(- Math.PI / 2),\r\n    new THREE.MeshBasicMaterial()\r\n  );\r\n  reticle.matrixAutoUpdate = false;\r\n  reticle.visible = false;\r\n  scene.add(reticle);\r\n\r\n  //\r\n\r\n  window.addEventListener('resize', onWindowResize);\r\n\r\n}\r\n\r\nfunction onWindowResize() {\r\n\r\n  camera.aspect = window.innerWidth / window.innerHeight;\r\n  camera.updateProjectionMatrix();\r\n\r\n  renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n}\r\n\r\n//\r\n\r\nfunction animate(timestamp, frame) {\r\n\r\n  if (frame) {\r\n\r\n    const referenceSpace = renderer.xr.getReferenceSpace();\r\n    const session = renderer.xr.getSession();\r\n\r\n    if (hitTestSourceRequested === false) {\r\n\r\n      session.requestReferenceSpace('viewer').then(function (referenceSpace) {\r\n\r\n        session.requestHitTestSource({ space: referenceSpace }).then(function (source) {\r\n\r\n          hitTestSource = source;\r\n\r\n        });\r\n\r\n      });\r\n\r\n      session.addEventListener('end', function () {\r\n\r\n        hitTestSourceRequested = false;\r\n        hitTestSource = null;\r\n\r\n      });\r\n\r\n      hitTestSourceRequested = true;\r\n\r\n    }\r\n\r\n    if (hitTestSource) {\r\n\r\n      const hitTestResults = frame.getHitTestResults(hitTestSource);\r\n\r\n      if (hitTestResults.length) {\r\n\r\n        const hit = hitTestResults[0];\r\n\r\n        reticle.visible = true;\r\n        reticle.matrix.fromArray(hit.getPose(referenceSpace).transform.matrix);\r\n\r\n      } else {\r\n\r\n        reticle.visible = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  renderer.render(scene, camera);\r\n\r\n}"],"names":["container","camera","scene","renderer","controller","reticle","hitTestSource","hitTestSourceRequested","model","loadedFlask","loadedTube","loadedGlassBottle","init","loader","GLTFLoader","THREE.Scene","THREE.PerspectiveCamera","light","THREE.HemisphereLight","THREE.WebGLRenderer","animate","ARButton","THREE.CylinderGeometry","onSelect","gltf","object","wiggle","currentTime","elapsedTime","startTime","duration","lastFrameTime","wiggleFrequency","scaleFactor","baseScale","wiggleAmplitude","THREE.Mesh","THREE.RingGeometry","THREE.MeshBasicMaterial","onWindowResize","timestamp","frame","referenceSpace","session","source","hitTestResults","hit"],"mappings":"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"}