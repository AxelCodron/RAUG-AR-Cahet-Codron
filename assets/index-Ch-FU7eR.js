import{af as _,ag as $,ah as F,ai as V,aj as ee,A as te,ak as ne,al as oe,v as se,am as re,M as ie,ac as ae,W as le}from"./three.core-CMfKxVgc.js";import{G as ce,A as de,I as ue,H as fe}from"./three.examples-M4widrNm.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const b=new _,p=new $,B=new F(b);p.load("assets/sounds/blue-bottle-click.mp3",e=>{B.setBuffer(e),B.setRefDistance(20),B.setVolume(.5)});const C=new F(b);p.load("assets/sounds/green-bottle-click.mp3",e=>{C.setBuffer(e),C.setRefDistance(20),C.setVolume(.5)});const H=new F(b);p.load("assets/sounds/orange-bottle-click.mp3",e=>{H.setBuffer(e),H.setRefDistance(20),H.setVolume(.5)});const D=new V(b);p.load("assets/sounds/win.mp3",e=>{D.setBuffer(e),D.setVolume(.5)});const G=new V(b);p.load("assets/sounds/game-over.mp3",e=>{G.setBuffer(e),G.setVolume(.5)});const I=new V(b);p.load("assets/sounds/good-sequence.mp3",e=>{I.setBuffer(e),I.setVolume(.5)});const K={"blue-bottle":B,"green-bottle":C,"orange-bottle":H,win:D,"game-over":G,"good-sequence":I};function be(e){e.add(b)}function A(e,t){e.add(K[t])}function a(e){K[e].play()}let z,m,w,i,v,u,L=null,O=!1,U,X,E=!1,q=new ae,R=!1;const S=new ce().setPath("/RAUG-AR-Cahet-Codron/assets/models/");z=document.createElement("div");document.body.appendChild(z);w=new ee;m=new te(70,window.innerWidth/window.innerHeight,.01,20);const J=new ne(16777215,12303359,3);J.position.set(.5,1,.25);w.add(J);i=new oe({antialias:!0,alpha:!0});i.setPixelRatio(window.devicePixelRatio);i.setSize(window.innerWidth,window.innerHeight);i.setAnimationLoop(Te);i.xr.enabled=!0;z.appendChild(i.domElement);document.body.appendChild(de.createButton(i,{requiredFeatures:["hit-test"]}));v=i.xr.getController(0);v.addEventListener("select",we);w.add(v);const y=new ue(i,m);y.listenToXRControllerEvents(v);w.add(y);u=new se(new re(.15,.2,32).rotateX(-Math.PI/2),new ie);u.matrixAutoUpdate=!1;u.visible=!1;w.add(u);window.addEventListener("resize",me);be(m);const f={intro:{content:"Hello scientist!</br>You must find the right combination of bottles</br>to create the remedy against the Covid 31!.</br>Begin by moving a bit to scan your surroundings.</br>When a circle appears, click on the screen to</br>place a bottle on the circle's location."},"blue-bottle":{content:"The blue bottle is the first ingredient of</br>the remedy.</br>It's known for its calming properties.</br>Place the second bottle now!"},"green-bottle":{content:"The green bottle is the second ingredient of</br>the remedy.</br>It's known for its healing properties.</br>Place the last bottle now!"},"orange-bottle":{content:"The orange bottle is the last ingredient of</br>the remedy.</br>It's known for its KOOL properties."},"game-description":{content:"You have now to create the remedy!</br>Look at the bottles and remember the sequence.</br>Then, click on the bottles in the same order to</br>create the remedy!</br>Reach a sequence of 7 to win.</br>Good luck!"},lose:{content:"Game Over!</br>You have failed to create the remedy against</br>the Covid 31!</br>Humanity is doomed and the world is lost :)"},win:{content:"Congratulations!</br>You have created the remedy against the</br>Covid 31!"}},c=document.getElementById("info-container");c.innerHTML=f.intro.content;const Q=new fe(c);Q.position.z=-.8;y.add(Q);let l=[],d=[],ge=["blue-bottle","green-bottle","orange-bottle"],M=!1,x=!1,T=!1,he=7;function me(){m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function pe(e){const t=new le;return t.identity().extractRotation(e.matrixWorld),q.ray.origin.setFromMatrixPosition(e.matrixWorld),q.ray.direction.set(0,0,-1).applyMatrix4(t),q.intersectObjects(y.children,!0)}function j(e,t,o){u.matrix.decompose(e.position,e.quaternion,e.scale),e.scale.set(t,t,t),e.userData.type=o;const s=e.scene||e;switch(s.scale.set(t,t,t),s.userData.type=o,y.add(s),o){case"blue-bottle":U=!0;break;case"green-bottle":X=!0;break;case"orange-bottle":E=!0;break}}function we(e){if(u.visible){let t,o,s;U?X?E||S.load("orange-bottle.glb",n=>{t=n.scene,o=.04,s="orange-bottle",j(t,o,s),c.innerHTML=f["orange-bottle"].content,A(t,"orange-bottle"),a("orange-bottle")}):S.load("green-bottle.glb",n=>{t=n.scene,o=40,s="green-bottle",j(t,o,s),c.innerHTML=f["green-bottle"].content,A(t,"green-bottle"),a("green-bottle")}):S.load("blue-bottle.glb",n=>{t=n.scene,o=.1,s="blue-bottle",j(t,o,s),c.innerHTML=f["blue-bottle"].content,A(t,"blue-bottle"),a("blue-bottle")})}if(R&&x&&!T){const t=e.target,o=pe(t);if(o.length>0){const n=o[0].object.parent.parent.parent.parent,r=n.scale.x;n.userData.type==="blue-bottle"?(h(n,r),M||(a("blue-bottle"),d.push("blue-bottle"),W(d.length-1))):n.parent.userData.type==="green-bottle"?(h(n,r,1e3,100,.1),M||(a("green-bottle"),d.push("green-bottle"),W(d.length-1))):n.parent.userData.type==="orange-bottle"&&(h(n,r,1e3,100,.15),M||(a("orange-bottle"),d.push("orange-bottle"),W(d.length-1)))}}R&&!x&&(c.style.display="none",Me(),x=!0),T&&(T=!1,x=!1),E&&!R&&(c.innerHTML=f["game-description"].content,R=!0),v.userData.targetRayMode=e.data.targetRayMode}function h(e,t,o=1e3,s=100,n=.02){const r=performance.now();let g=r;function Y(){const P=performance.now(),N=P-r;if(N<o){if(P-g>=s){g=P;const k=t+n*Math.sin(N/1e3*s*2*Math.PI);e.scale.set(k,k,k)}requestAnimationFrame(Y)}else e.scale.set(t,t,t)}Y()}function Z(){let e=ge[Math.floor(Math.random()*3)];l.push(e),console.log(l),ye()}function W(e){l[e]===d[e]?d.length===l.length&&(console.log("success"),d=[],a("good-sequence"),l.length===he?(console.log("You win"),a("win"),T=!0,c.style.display="block",c.innerHTML=f.win.content):setTimeout(function(){Z()},3e3)):setTimeout(function(){console.log("wrong"),a("game-over"),T=!0,c.style.display="block",c.innerHTML=f.lose.content},200)}function ye(){M=!0,setTimeout(function(){M=!1},1e3*l.length);for(let e=0;e<l.length;e++)setTimeout(function(){let t=y.children.find(s=>s.userData.type===l[e]).children[0],o=t.scale.x;l[e]==="blue-bottle"?(t=t.parent,o=t.scale.x,h(t,o),a("blue-bottle")):l[e]==="green-bottle"?(h(t,o,1e3,100,.1),a("green-bottle")):l[e]==="orange-bottle"&&(h(t,o,1e3,100,.15),a("orange-bottle"))},1e3*e)}function Me(){l=[],d=[],Z()}function Te(e,t){if(t){const o=i.xr.getReferenceSpace(),s=i.xr.getSession();if(O===!1&&(s.requestReferenceSpace("viewer").then(function(n){s.requestHitTestSource({space:n}).then(function(r){L=r})}),s.addEventListener("end",function(){O=!1,L=null}),O=!0),L){const n=t.getHitTestResults(L);if(n.length){const r=n[0];u.visible=!0,u.matrix.fromArray(r.getPose(o).transform.matrix)}else u.visible=!1}}i.render(w,m)}
//# sourceMappingURL=index-Ch-FU7eR.js.map
