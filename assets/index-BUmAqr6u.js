import{af as D,A as F,ag as z,ah as Y,v as N,ai as K,M as U,ac as X,W as J}from"./three.core-B18ZhZg7.js";import{G as Q,A as V,I as Z,H as _}from"./three.examples-xww44oi5.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();let q,y,g,s,M,d,T=null,R=!1,G,I,A=!1,H=new X,v=!1;const P=new Q().setPath("/RAUG-AR-Cahet-Codron/assets/models/");q=document.createElement("div");document.body.appendChild(q);g=new D;y=new F(70,window.innerWidth/window.innerHeight,.01,20);const j=new z(16777215,12303359,3);j.position.set(.5,1,.25);g.add(j);s=new Y({antialias:!0,alpha:!0});s.setPixelRatio(window.devicePixelRatio);s.setSize(window.innerWidth,window.innerHeight);s.setAnimationLoop(ie);s.xr.enabled=!0;q.appendChild(s.domElement);document.body.appendChild(V.createButton(s,{requiredFeatures:["hit-test"]}));M=s.xr.getController(0);M.addEventListener("select",oe);g.add(M);const p=new Z(s,y);p.listenToXRControllerEvents(M);g.add(p);d=new N(new K(.15,.2,32).rotateX(-Math.PI/2),new U);d.matrixAutoUpdate=!1;d.visible=!1;g.add(d);window.addEventListener("resize",te);const u={intro:{content:"Hello scientist!</br>You must find the right combination of bottles</br>to create the remedy against the Covid 31!.</br>Begin by moving a bit to scan your surroundings.</br>When a circle appears, click on the screen to</br>place a bottle on the circle's location."},"blue-bottle":{content:"The blue bottle is the first ingredient of</br>the remedy.</br>It's known for its calming properties.</br>Place the second bottle now!"},"green-bottle":{content:"The green bottle is the second ingredient of</br>the remedy.</br>It's known for its healing properties.</br>Place the last bottle now!"},"orange-bottle":{content:"The orange bottle is the last ingredient of</br>the remedy.</br>It's known for its KOOL properties."},"game-description":{content:"You have now to create the remedy!</br>Look at the bottles and remember the sequence.</br>Then, click on the bottles in the same order to</br>create the remedy!</br>Reach a sequence of 7 to win.</br>Good luck!"},lose:{content:"Game Over!</br>You have failed to create the remedy against</br>the Covid 31!</br>Humanity is doomed and the world is lost :)"},win:{content:"Congratulations!</br>You have created the remedy against the</br>Covid 31!"}},l=document.getElementById("info-container");l.innerHTML=u.intro.content;const k=new _(l);k.position.z=-.8;p.add(k);let a=[],c=[],$=["blue-bottle","green-bottle","orange-bottle"],m=!1,h=!1,w=!1,ee=7;function te(){y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}function ne(n){const e=new J;return e.identity().extractRotation(n.matrixWorld),H.ray.origin.setFromMatrixPosition(n.matrixWorld),H.ray.direction.set(0,0,-1).applyMatrix4(e),H.intersectObjects(p.children,!0)}function C(n,e,o){d.matrix.decompose(n.position,n.quaternion,n.scale),n.scale.set(e,e,e),n.userData.type=o;const r=n.scene||n;switch(r.scale.set(e,e,e),r.userData.type=o,p.add(r),o){case"blue-bottle":G=!0;break;case"green-bottle":I=!0;break;case"orange-bottle":A=!0;break}}function oe(n){if(d.visible){let e,o,r;G?I?A||P.load("orange-bottle.glb",t=>{e=t.scene,o=.04,r="orange-bottle",C(e,o,r),l.innerHTML=u["orange-bottle"].content}):P.load("green-bottle.glb",t=>{e=t.scene,o=40,r="green-bottle",C(e,o,r),l.innerHTML=u["green-bottle"].content}):P.load("blue-bottle.glb",t=>{e=t.scene,o=.1,r="blue-bottle",C(e,o,r),l.innerHTML=u["blue-bottle"].content})}if(v&&h&&!w){const e=n.target,o=ne(e);if(o.length>0){const t=o[0].object.parent.parent.parent.parent,i=t.scale.x;t.userData.type==="blue-bottle"?(b(t,i),h||(B(),h=!0),m||(c.push("blue-bottle"),O(c.length-1))):t.parent.userData.type==="green-bottle"?(b(t,i,1e3,100,.1),m||(c.push("green-bottle"),O(c.length-1))):t.parent.userData.type==="orange-bottle"&&(b(t,i,1e3,100,.15),m||(c.push("orange-bottle"),O(c.length-1)))}}v&&!h&&(l.style.display="none",B(),h=!0),w&&(w=!1,h=!1),A&&!v&&(l.innerHTML=u["game-description"].content,v=!0),M.userData.targetRayMode=n.data.targetRayMode}function b(n,e,o=1e3,r=100,t=.02){const i=performance.now();let f=i;function S(){const x=performance.now(),W=x-i;if(W<o){if(x-f>=r){f=x;const L=e+t*Math.sin(W/1e3*r*2*Math.PI);n.scale.set(L,L,L)}requestAnimationFrame(S)}else n.scale.set(e,e,e)}S()}function E(){let n=$[Math.floor(Math.random()*3)];a.push(n),console.log(a),re()}function O(n){a[n]===c[n]?c.length===a.length&&(console.log("success"),c=[],a.length===ee?(console.log("You win"),w=!0,l.style.display="block",l.innerHTML=u.win.content):setTimeout(function(){E()},3e3)):setTimeout(function(){console.log("wrong"),w=!0,l.style.display="block",l.innerHTML=u.lose.content},200)}function re(){m=!0,setTimeout(function(){m=!1},1e3*a.length);for(let n=0;n<a.length;n++)setTimeout(function(){let e=p.children.find(r=>r.userData.type===a[n]).children[0],o=e.scale.x;a[n]==="blue-bottle"?(e=e.parent,o=e.scale.x,b(e,o)):a[n]==="green-bottle"?b(e,o,1e3,100,.1):a[n]==="orange-bottle"&&b(e,o,1e3,100,.15)},1e3*n)}function B(){a=[],c=[],E()}function ie(n,e){if(e){const o=s.xr.getReferenceSpace(),r=s.xr.getSession();if(R===!1&&(r.requestReferenceSpace("viewer").then(function(t){r.requestHitTestSource({space:t}).then(function(i){T=i})}),r.addEventListener("end",function(){R=!1,T=null}),R=!0),T){const t=e.getHitTestResults(T);if(t.length){const i=t[0];d.visible=!0,d.matrix.fromArray(i.getPose(o).transform.matrix)}else d.visible=!1}}s.render(g,y)}
//# sourceMappingURL=index-BUmAqr6u.js.map
