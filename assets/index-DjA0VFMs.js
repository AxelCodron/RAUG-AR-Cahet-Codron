import{af as $,ag as ee,ah as V,ai as z,aj as te,A as ne,ak as oe,al as se,v as re,am as ie,M as ae,ac as le,W as ce}from"./three.core-CMfKxVgc.js";import{G as de,A as ue,I as fe,H as be}from"./three.examples-M4widrNm.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const g=new $,w=new ee,C=new V(g);w.load("assets/sounds/blue-bottle-click.mp3",e=>{C.setBuffer(e),C.setRefDistance(20),C.setVolume(.5)});const H=new V(g);w.load("assets/sounds/green-bottle-click.mp3",e=>{H.setBuffer(e),H.setRefDistance(20),H.setVolume(.5)});const P=new V(g);w.load("assets/sounds/orange-bottle-click.mp3",e=>{P.setBuffer(e),P.setRefDistance(20),P.setVolume(.5)});const G=new z(g);w.load("assets/sounds/win.mp3",e=>{G.setBuffer(e),G.setVolume(.5)});const I=new z(g);w.load("assets/sounds/game-over.mp3",e=>{I.setBuffer(e),I.setVolume(.5)});const F=new z(g);w.load("assets/sounds/good-sequence.mp3",e=>{F.setBuffer(e),F.setVolume(.5)});const U={"blue-bottle":C,"green-bottle":H,"orange-bottle":P,win:G,"game-over":I,"good-sequence":F};function ge(e){e.add(g)}function q(e,t){e.add(U[t])}function a(e){U[e].play()}let Y,p,y,i,L,u,R=null,S=!1,X,J,A=!1,j=new le,x=!1;const W=new de().setPath("/RAUG-AR-Cahet-Codron/assets/models/");Y=document.createElement("div");document.body.appendChild(Y);y=new te;p=new ne(70,window.innerWidth/window.innerHeight,.01,20);const Q=new oe(16777215,12303359,3);Q.position.set(.5,1,.25);y.add(Q);i=new se({antialias:!0,alpha:!0});i.setPixelRatio(window.devicePixelRatio);i.setSize(window.innerWidth,window.innerHeight);i.setAnimationLoop(Te);i.xr.enabled=!0;Y.appendChild(i.domElement);const Z=ue.createButton(i,{requiredFeatures:["hit-test"]});document.body.appendChild(Z);L=i.xr.getController(0);L.addEventListener("select",ye);y.add(L);const v=new fe(i,p);v.listenToXRControllerEvents(L);y.add(v);u=new re(new ie(.15,.2,32).rotateX(-Math.PI/2),new ae);u.matrixAutoUpdate=!1;u.visible=!1;y.add(u);window.addEventListener("resize",pe);ge(p);const f={intro:{content:"Hello scientist!</br>You must find the right combination of bottles</br>to create the remedy against the Covid 31!.</br>Begin by moving a bit to scan your surroundings.</br>When a circle appears, click on the screen to</br>place a bottle on the circle's location."},"blue-bottle":{content:"The blue bottle is the first ingredient of</br>the remedy.</br>It's known for its calming properties.</br>Place the second bottle now!"},"green-bottle":{content:"The green bottle is the second ingredient of</br>the remedy.</br>It's known for its healing properties.</br>Place the last bottle now!"},"orange-bottle":{content:"The orange bottle is the last ingredient of</br>the remedy.</br>It's known for its KOOL properties."},"game-description":{content:"You have now to create the remedy!</br>Look at the bottles and remember the sequence.</br>Then, click on the bottles in the same order to</br>create the remedy!</br>Reach a sequence of 7 to win.</br>Good luck!"},lose:{content:"Game Over!</br>You have failed to create the remedy against</br>the Covid 31!</br>Humanity is doomed and the world is lost :)"},win:{content:"Congratulations!</br>You have created the remedy against the</br>Covid 31!"}},d=document.getElementById("info-container");d.innerHTML=f.intro.content;d.style.visibility="hidden";const b=new be(d);b.position.z=-.8;b.visible=!1;v.add(b);Z.addEventListener("click",function(){console.log("AR Button clicked"),b.visible=!0,d.style.visibility="visible"});let l=[],c=[],he=["blue-bottle","green-bottle","orange-bottle"],M=!1,B=!1,T=!1,me=7;function pe(){p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function we(e){const t=new ce;return t.identity().extractRotation(e.matrixWorld),j.ray.origin.setFromMatrixPosition(e.matrixWorld),j.ray.direction.set(0,0,-1).applyMatrix4(t),j.intersectObjects(v.children,!0)}function D(e,t,o){u.matrix.decompose(e.position,e.quaternion,e.scale),e.scale.set(t,t,t),e.userData.type=o;const s=e.scene||e;switch(s.scale.set(t,t,t),s.userData.type=o,v.add(s),o){case"blue-bottle":X=!0;break;case"green-bottle":J=!0;break;case"orange-bottle":A=!0;break}}function ye(e){if(u.visible){let t,o,s;X?J?A||W.load("orange-bottle.glb",n=>{t=n.scene,o=.04,s="orange-bottle",D(t,o,s),d.innerHTML=f["orange-bottle"].content,q(t,"orange-bottle"),a("orange-bottle")}):W.load("green-bottle.glb",n=>{t=n.scene,o=40,s="green-bottle",D(t,o,s),d.innerHTML=f["green-bottle"].content,q(t,"green-bottle"),a("green-bottle")}):W.load("blue-bottle.glb",n=>{t=n.scene,o=.1,s="blue-bottle",D(t,o,s),d.innerHTML=f["blue-bottle"].content,q(t,"blue-bottle"),a("blue-bottle")})}if(x&&B&&!T){const t=e.target,o=we(t);if(o.length>0){const n=o[0].object.parent.parent.parent.parent,r=n.scale.x;n.userData.type==="blue-bottle"?(m(n,r),M||(a("blue-bottle"),c.push("blue-bottle"),E(c.length-1))):n.parent.userData.type==="green-bottle"?(m(n,r,1e3,100,.1),M||(a("green-bottle"),c.push("green-bottle"),E(c.length-1))):n.parent.userData.type==="orange-bottle"&&(m(n,r,1e3,100,.15),M||(a("orange-bottle"),c.push("orange-bottle"),E(c.length-1)))}}x&&!B&&(b.visible=!1,Me(),B=!0),T&&(T=!1,B=!1),A&&!x&&(d.innerHTML=f["game-description"].content,x=!0),L.userData.targetRayMode=e.data.targetRayMode}function m(e,t,o=1e3,s=100,n=.02){const r=performance.now();let h=r;function N(){const k=performance.now(),K=k-r;if(K<o){if(k-h>=s){h=k;const O=t+n*Math.sin(K/1e3*s*2*Math.PI);e.scale.set(O,O,O)}requestAnimationFrame(N)}else e.scale.set(t,t,t)}N()}function _(){let e=he[Math.floor(Math.random()*3)];l.push(e),console.log(l),ve()}function E(e){l[e]===c[e]?c.length===l.length&&(console.log("success"),c=[],a("good-sequence"),l.length===me?(console.log("You win"),a("win"),T=!0,b.visible=!0,d.innerHTML=f.win.content):setTimeout(function(){_()},3e3)):setTimeout(function(){console.log("wrong"),a("game-over"),T=!0,b.visible=!0,d.innerHTML=f.lose.content},200)}function ve(){M=!0,setTimeout(function(){M=!1},1e3*l.length);for(let e=0;e<l.length;e++)setTimeout(function(){let t=v.children.find(s=>s.userData.type===l[e]).children[0],o=t.scale.x;l[e]==="blue-bottle"?(t=t.parent,o=t.scale.x,m(t,o),a("blue-bottle")):l[e]==="green-bottle"?(m(t,o,1e3,100,.1),a("green-bottle")):l[e]==="orange-bottle"&&(m(t,o,1e3,100,.15),a("orange-bottle"))},1e3*e)}function Me(){l=[],c=[],_()}function Te(e,t){if(t){const o=i.xr.getReferenceSpace(),s=i.xr.getSession();if(S===!1&&(s.requestReferenceSpace("viewer").then(function(n){s.requestHitTestSource({space:n}).then(function(r){R=r})}),s.addEventListener("end",function(){S=!1,R=null}),S=!0),R){const n=t.getHitTestResults(R);if(n.length&&!A){const r=n[0];u.visible=!0,u.matrix.fromArray(r.getPose(o).transform.matrix)}else u.visible=!1}}i.render(y,p)}
//# sourceMappingURL=index-DjA0VFMs.js.map
