{"version":3,"file":"index-CGhfoHC3.js","sources":["../../src/main.js"],"sourcesContent":["import * as THREE from 'three';\r\nimport { ARButton } from 'three/addons/webxr/ARButton.js';\r\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\r\n\r\nlet container;\r\nlet camera, scene, renderer;\r\nlet controller;\r\n\r\nlet reticle;\r\n\r\nlet hitTestSource = null;\r\nlet hitTestSourceRequested = false;\r\n\r\nlet model\r\n\r\ninit();\r\n\r\nfunction init() {\r\n\r\n  const loader = new GLTFLoader().setPath('/RAUG-AR-Cahet-Codron/assets/models/');\r\n\r\n  container = document.createElement('div');\r\n  document.body.appendChild(container);\r\n\r\n  scene = new THREE.Scene();\r\n\r\n  camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);\r\n\r\n  const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 3);\r\n  light.position.set(0.5, 1, 0.25);\r\n  scene.add(light);\r\n\r\n  //\r\n\r\n  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\r\n  renderer.setPixelRatio(window.devicePixelRatio);\r\n  renderer.setSize(window.innerWidth, window.innerHeight);\r\n  renderer.setAnimationLoop(animate);\r\n  renderer.xr.enabled = true;\r\n  container.appendChild(renderer.domElement);\r\n\r\n  //\r\n\r\n  document.body.appendChild(ARButton.createButton(renderer, { requiredFeatures: ['hit-test'] }));\r\n\r\n  //\r\n\r\n  const geometry = new THREE.CylinderGeometry(0.1, 0.1, 0.2, 32).translate(0, 0.1, 0);\r\n\r\n  function onSelect() {\r\n\r\n    if (reticle.visible) {\r\n\r\n      // Load a glTF resource\r\n      loader.load('flask.glb', (gltf) => {\r\n        model = gltf.scene;\r\n\r\n        model.scale.set(0.01, 0.01, 0.01);\r\n\r\n        scene.add(model);\r\n\r\n        model.traverse(function (object) {\r\n          if (object.isMesh) object.castShadow = true;\r\n        });\r\n      });\r\n\r\n      // const material = new THREE.MeshPhongMaterial({ color: 0xffffff * Math.random() });\r\n      // const mesh = new THREE.Mesh(geometry, material);\r\n      // reticle.matrix.decompose(mesh.position, mesh.quaternion, mesh.scale);\r\n      // mesh.scale.y = Math.random() * 2 + 1;\r\n      // scene.add(mesh);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  controller = renderer.xr.getController(0);\r\n  controller.addEventListener('select', onSelect);\r\n  scene.add(controller);\r\n\r\n  reticle = new THREE.Mesh(\r\n    new THREE.RingGeometry(0.15, 0.2, 32).rotateX(- Math.PI / 2),\r\n    new THREE.MeshBasicMaterial()\r\n  );\r\n  reticle.matrixAutoUpdate = false;\r\n  reticle.visible = false;\r\n  scene.add(reticle);\r\n\r\n  //\r\n\r\n  window.addEventListener('resize', onWindowResize);\r\n\r\n}\r\n\r\nfunction onWindowResize() {\r\n\r\n  camera.aspect = window.innerWidth / window.innerHeight;\r\n  camera.updateProjectionMatrix();\r\n\r\n  renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n}\r\n\r\n//\r\n\r\nfunction animate(timestamp, frame) {\r\n\r\n  if (frame) {\r\n\r\n    const referenceSpace = renderer.xr.getReferenceSpace();\r\n    const session = renderer.xr.getSession();\r\n\r\n    if (hitTestSourceRequested === false) {\r\n\r\n      session.requestReferenceSpace('viewer').then(function (referenceSpace) {\r\n\r\n        session.requestHitTestSource({ space: referenceSpace }).then(function (source) {\r\n\r\n          hitTestSource = source;\r\n\r\n        });\r\n\r\n      });\r\n\r\n      session.addEventListener('end', function () {\r\n\r\n        hitTestSourceRequested = false;\r\n        hitTestSource = null;\r\n\r\n      });\r\n\r\n      hitTestSourceRequested = true;\r\n\r\n    }\r\n\r\n    if (hitTestSource) {\r\n\r\n      const hitTestResults = frame.getHitTestResults(hitTestSource);\r\n\r\n      if (hitTestResults.length) {\r\n\r\n        const hit = hitTestResults[0];\r\n\r\n        reticle.visible = true;\r\n        reticle.matrix.fromArray(hit.getPose(referenceSpace).transform.matrix);\r\n\r\n      } else {\r\n\r\n        reticle.visible = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  renderer.render(scene, camera);\r\n\r\n}"],"names":["container","camera","scene","renderer","controller","reticle","hitTestSource","hitTestSourceRequested","model","init","loader","GLTFLoader","THREE.Scene","THREE.PerspectiveCamera","light","THREE.HemisphereLight","THREE.WebGLRenderer","animate","ARButton","THREE.CylinderGeometry","onSelect","gltf","object","THREE.Mesh","THREE.RingGeometry","THREE.MeshBasicMaterial","onWindowResize","timestamp","frame","referenceSpace","session","source","hitTestResults","hit"],"mappings":"i2BAIA,IAAIA,EACAC,EAAQC,EAAOC,EACfC,EAEAC,EAEAC,EAAgB,KAChBC,EAAyB,GAEzBC,EAEJC,IAEA,SAASA,GAAO,CAEd,MAAMC,EAAS,IAAIC,EAAY,EAAC,QAAQ,sCAAsC,EAE9EX,EAAY,SAAS,cAAc,KAAK,EACxC,SAAS,KAAK,YAAYA,CAAS,EAEnCE,EAAQ,IAAIU,EAEZX,EAAS,IAAIY,EAAwB,GAAI,OAAO,WAAa,OAAO,YAAa,IAAM,EAAE,EAEzF,MAAMC,EAAQ,IAAIC,EAAsB,SAAU,SAAU,CAAC,EAC7DD,EAAM,SAAS,IAAI,GAAK,EAAG,GAAI,EAC/BZ,EAAM,IAAIY,CAAK,EAIfX,EAAW,IAAIa,EAAoB,CAAE,UAAW,GAAM,MAAO,EAAI,CAAE,EACnEb,EAAS,cAAc,OAAO,gBAAgB,EAC9CA,EAAS,QAAQ,OAAO,WAAY,OAAO,WAAW,EACtDA,EAAS,iBAAiBc,CAAO,EACjCd,EAAS,GAAG,QAAU,GACtBH,EAAU,YAAYG,EAAS,UAAU,EAIzC,SAAS,KAAK,YAAYe,EAAS,aAAaf,EAAU,CAAE,iBAAkB,CAAC,UAAU,CAAC,CAAE,CAAC,EAI5E,IAAIgB,EAAuB,GAAK,GAAK,GAAK,EAAE,EAAE,UAAU,EAAG,GAAK,CAAC,EAElF,SAASC,GAAW,CAEdf,EAAQ,SAGVK,EAAO,KAAK,YAAcW,GAAS,CACjCb,EAAQa,EAAK,MAEbb,EAAM,MAAM,IAAI,IAAM,IAAM,GAAI,EAEhCN,EAAM,IAAIM,CAAK,EAEfA,EAAM,SAAS,SAAUc,EAAQ,CAC3BA,EAAO,SAAQA,EAAO,WAAa,GACjD,CAAS,CACT,CAAO,CAUJ,CAEDlB,EAAaD,EAAS,GAAG,cAAc,CAAC,EACxCC,EAAW,iBAAiB,SAAUgB,CAAQ,EAC9ClB,EAAM,IAAIE,CAAU,EAEpBC,EAAU,IAAIkB,EACZ,IAAIC,EAAmB,IAAM,GAAK,EAAE,EAAE,QAAQ,CAAE,KAAK,GAAK,CAAC,EAC3D,IAAIC,CACR,EACEpB,EAAQ,iBAAmB,GAC3BA,EAAQ,QAAU,GAClBH,EAAM,IAAIG,CAAO,EAIjB,OAAO,iBAAiB,SAAUqB,CAAc,CAElD,CAEA,SAASA,GAAiB,CAExBzB,EAAO,OAAS,OAAO,WAAa,OAAO,YAC3CA,EAAO,uBAAsB,EAE7BE,EAAS,QAAQ,OAAO,WAAY,OAAO,WAAW,CAExD,CAIA,SAASc,EAAQU,EAAWC,EAAO,CAEjC,GAAIA,EAAO,CAET,MAAMC,EAAiB1B,EAAS,GAAG,kBAAiB,EAC9C2B,EAAU3B,EAAS,GAAG,WAAU,EAyBtC,GAvBII,IAA2B,KAE7BuB,EAAQ,sBAAsB,QAAQ,EAAE,KAAK,SAAUD,EAAgB,CAErEC,EAAQ,qBAAqB,CAAE,MAAOD,CAAc,CAAE,EAAE,KAAK,SAAUE,EAAQ,CAE7EzB,EAAgByB,CAE1B,CAAS,CAET,CAAO,EAEDD,EAAQ,iBAAiB,MAAO,UAAY,CAE1CvB,EAAyB,GACzBD,EAAgB,IAExB,CAAO,EAEDC,EAAyB,IAIvBD,EAAe,CAEjB,MAAM0B,EAAiBJ,EAAM,kBAAkBtB,CAAa,EAE5D,GAAI0B,EAAe,OAAQ,CAEzB,MAAMC,EAAMD,EAAe,CAAC,EAE5B3B,EAAQ,QAAU,GAClBA,EAAQ,OAAO,UAAU4B,EAAI,QAAQJ,CAAc,EAAE,UAAU,MAAM,CAE7E,MAEQxB,EAAQ,QAAU,EAIrB,CAEF,CAEDF,EAAS,OAAOD,EAAOD,CAAM,CAE/B"}